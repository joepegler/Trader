<!DOCTYPE html>

<html>
<head>
  <title>bitfinex.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>bitfinex.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="initialisation">Initialisation</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Library imports</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> <span class="hljs-built_in">Promise</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'promise'</span>);
    <span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);
    <span class="hljs-keyword">const</span> BFX = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bitfinex-api-node'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Local imports</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> configKeys = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>);
    <span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/logger'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Configure imports</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> bitfinexRest = <span class="hljs-keyword">new</span> BFX(configKeys.rest.key, configKeys.rest.secret, {<span class="hljs-attr">version</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span>}).rest;
    <span class="hljs-keyword">const</span> bitfinexWebsocket = <span class="hljs-keyword">new</span> BFX(configKeys.websocket.key, configKeys.websocket.secret, {
        <span class="hljs-attr">version</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span>
    }).ws;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Local variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> usdPrices = {};
    <span class="hljs-keyword">let</span> prices = {};
    <span class="hljs-keyword">let</span> exchangePairNames = {
        <span class="hljs-attr">ETHBTC</span>: <span class="hljs-string">'ETHBTC'</span>,
        <span class="hljs-attr">BTCUSD</span>: <span class="hljs-string">'BTCUSD'</span>,
        <span class="hljs-attr">LTCBTC</span>: <span class="hljs-string">'LTCBTC'</span>,
        <span class="hljs-attr">XRPBTC</span>: <span class="hljs-string">'XRPBTC'</span>,
        <span class="hljs-attr">XMRBTC</span>: <span class="hljs-string">'XMRBTC'</span>,
        <span class="hljs-attr">DSHBTC</span>: <span class="hljs-string">'DSHBTC'</span>
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="functions">Functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><code>_init</code> Initiates the price ticker and retrieves the current account balance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _init = <span class="hljs-function">(<span class="hljs-params">pairs</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            exchangePairNames = _.pickBy(exchangePairNames, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coinVal, coinName</span>) </span>{ <span class="hljs-comment">// exchangePairNames needs to be filtered by the 'pairs' argument</span>
                <span class="hljs-keyword">return</span> _.includes(pairs, coinName)
            });
            <span class="hljs-keyword">const</span> invertedMap = _.invert(exchangePairNames);
            bitfinexWebsocket.on(<span class="hljs-string">'open'</span>, () =&gt; { <span class="hljs-comment">// When the websocket opens</span>
                bitfinexWebsocket.auth(); <span class="hljs-comment">// Authenticate once the websocket has been opened.</span>
            });
            bitfinexWebsocket.on(<span class="hljs-string">'error'</span>, logger.error); <span class="hljs-comment">// When the websocket errs</span>
            bitfinexWebsocket.on(<span class="hljs-string">'auth'</span>, () =&gt; {
                <span class="hljs-keyword">let</span> foundPrice = <span class="hljs-literal">false</span>; <span class="hljs-comment">// Only resolve once price has been found.</span>
                _.each(exchangePairNames, pair =&gt; { <span class="hljs-comment">// Loop the exchange coin names and subscribe to each of the pairs</span>
                    bitfinexWebsocket.subscribeTicker(<span class="hljs-string">'t'</span> + pair);
                    pair.indexOf(<span class="hljs-string">'USD'</span>) === <span class="hljs-number">-1</span> &amp;&amp; bitfinexWebsocket.subscribeTicker(<span class="hljs-string">'t'</span> + pair.slice(<span class="hljs-number">0</span>, <span class="hljs-number">-3</span>) + <span class="hljs-string">'USD'</span>); <span class="hljs-comment">// also subscribe to usd value</span>
                });
                bitfinexWebsocket.on(<span class="hljs-string">'ticker'</span>, (ePair, ticker) =&gt; { <span class="hljs-comment">// Every time there's an update to the price</span>
                    ePair = ePair.substring(<span class="hljs-number">1</span>).toUpperCase(); <span class="hljs-comment">// Most ePair are of the format: tETH / tXMR, except Bitcoin</span>
                    <span class="hljs-keyword">let</span> pair = invertedMap[ePair]; <span class="hljs-comment">// Get the original name of the pair from the inverted map.</span>
                    <span class="hljs-keyword">if</span> (pair) { <span class="hljs-comment">// And update the prices object.</span>
                        prices[pair] = {
                            <span class="hljs-attr">exchange</span>: <span class="hljs-string">'bitfinex'</span>,
                            <span class="hljs-attr">pair</span>: pair,
                            <span class="hljs-attr">ask</span>: <span class="hljs-built_in">parseFloat</span>(ticker.ASK),
                            <span class="hljs-attr">mid</span>: <span class="hljs-built_in">parseFloat</span>((<span class="hljs-built_in">parseFloat</span>(ticker.ASK) + <span class="hljs-built_in">parseFloat</span>(ticker.BID)) / <span class="hljs-number">2</span>),
                            <span class="hljs-attr">bid</span>: <span class="hljs-built_in">parseFloat</span>(ticker.BID),
                        };
                    }
                    <span class="hljs-keyword">if</span> (!pair || pair === <span class="hljs-string">'BTCUSD'</span>) {
                        usdPrices[ePair] = {
                            <span class="hljs-attr">exchange</span>: <span class="hljs-string">'bitfinex'</span>,
                            <span class="hljs-attr">pair</span>: ePair,
                            <span class="hljs-attr">ask</span>: <span class="hljs-built_in">parseFloat</span>(ticker.ASK),
                            <span class="hljs-attr">mid</span>: <span class="hljs-built_in">parseFloat</span>((<span class="hljs-built_in">parseFloat</span>(ticker.ASK) + <span class="hljs-built_in">parseFloat</span>(ticker.BID)) / <span class="hljs-number">2</span>),
                            <span class="hljs-attr">bid</span>: <span class="hljs-built_in">parseFloat</span>(ticker.BID),
                        };
                    }
                    <span class="hljs-keyword">if</span> (!foundPrice) {<span class="hljs-comment">// Only resolve after the price has been found.</span>
                        resolve(prices);
                        foundPrice = <span class="hljs-literal">true</span>;
                    }
                });
            });
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><code>_pairIsEnabled</code> is used to determine
which pairs were initialised during setup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _pairIsEnabled = <span class="hljs-function">(<span class="hljs-params">pair</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> !!_.invert(exchangePairNames)[pair];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><code>_getBalances</code> returns a balances array. The balances
list the available tradeable balance for each coin,
with (tradeable) and without (balance) leverage.</p>
<pre><code> [
     {
         <span class="hljs-attr">pair</span>: <span class="hljs-string">'ETHBTC'</span>,
         <span class="hljs-attr">balance</span>: <span class="hljs-number">192.338</span>,
         <span class="hljs-attr">tradeable</span>: <span class="hljs-number">480.845</span>
     }
 ]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _getBalances = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            bitfinexRest.margin_infos(<span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> { <span class="hljs-comment">// Gets bitfinex account margin data</span>
                <span class="hljs-keyword">if</span> (!err) {
                    <span class="hljs-keyword">let</span> balances = [];
                    _.each(exchangePairNames, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">exchangeCoinName, coinName</span>) </span>{
                        <span class="hljs-keyword">let</span> usdPair = coinName.slice(<span class="hljs-number">0</span>, <span class="hljs-number">-3</span>) + <span class="hljs-string">'USD'</span>;
                        balances.push({
                            <span class="hljs-attr">pair</span>: coinName,
                            <span class="hljs-attr">balance</span>: <span class="hljs-built_in">parseFloat</span>(data[<span class="hljs-number">0</span>].margin_balance / usdPrices[usdPair].ask),
                            <span class="hljs-attr">tradeable</span>: <span class="hljs-built_in">parseFloat</span>(_.find(data[<span class="hljs-number">0</span>].margin_limits, {<span class="hljs-attr">on_pair</span>: exchangeCoinName}).tradable_balance / usdPrices[usdPair].ask)
                        });
                    });
                    resolve(balances);
                }
                <span class="hljs-keyword">else</span> {
                    reject(err); <span class="hljs-comment">// Reject the promise</span>
                }
            });
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><code>_getActiveOrders</code> returns all active orders active on bitfinex</p>
<pre><code> [
     {
         <span class="hljs-string">"id"</span>:<span class="hljs-number">5243424763</span>,
         <span class="hljs-string">"pair"</span>:<span class="hljs-string">"ETHBTC"</span>,
         <span class="hljs-string">"price"</span>: <span class="hljs-number">0.043615</span>,
         <span class="hljs-string">"side"</span>:<span class="hljs-string">"buy"</span>
     },
 ]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _getActiveOrders = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            bitfinexRest.active_orders(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, activeOrderResponse</span>) </span>{
                <span class="hljs-keyword">if</span> (!err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <pre><code> activeOrderResponse = [
     {
         <span class="hljs-string">"id"</span>:<span class="hljs-number">5243424763</span>,
         <span class="hljs-string">"cid"</span>:<span class="hljs-number">59796173969</span>,
         <span class="hljs-string">"cid_date"</span>:<span class="hljs-string">"2017-11-18"</span>,
         <span class="hljs-string">"gid"</span>:<span class="hljs-literal">null</span>,
         <span class="hljs-string">"symbol"</span>:<span class="hljs-string">"ethbtc"</span>,
         <span class="hljs-string">"exchange"</span>:<span class="hljs-literal">null</span>,
         <span class="hljs-string">"price"</span>:<span class="hljs-string">"0.043615"</span>,
         <span class="hljs-string">"avg_execution_price"</span>:<span class="hljs-string">"0.0"</span>,
         <span class="hljs-string">"side"</span>:<span class="hljs-string">"buy"</span>,
         <span class="hljs-string">"type"</span>:<span class="hljs-string">"limit"</span>,
         <span class="hljs-string">"timestamp"</span>:<span class="hljs-string">"1511022996.0"</span>,
         <span class="hljs-string">"is_live"</span>:<span class="hljs-literal">true</span>,
         <span class="hljs-string">"is_cancelled"</span>:<span class="hljs-literal">false</span>,
         <span class="hljs-string">"is_hidden"</span>:<span class="hljs-literal">false</span>,
         <span class="hljs-string">"oco_order"</span>:<span class="hljs-literal">null</span>,
         <span class="hljs-string">"was_forced"</span>:<span class="hljs-literal">false</span>,
         <span class="hljs-string">"original_amount"</span>:<span class="hljs-string">"0.25"</span>,
         <span class="hljs-string">"remaining_amount"</span>:<span class="hljs-string">"0.25"</span>,
         <span class="hljs-string">"executed_amount"</span>:<span class="hljs-string">"0.0"</span>,
         <span class="hljs-string">"src"</span>:<span class="hljs-string">"web"</span>
     }
 ];
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">let</span> activeOrders = [];
                    <span class="hljs-keyword">const</span> invertedMap = _.invert(exchangePairNames);
                    activeOrderResponse.forEach(<span class="hljs-function">(<span class="hljs-params">activeOrder</span>) =&gt;</span> {
                        activeOrders.push({
                            <span class="hljs-attr">id</span>: activeOrder.id.toString(),
                            <span class="hljs-attr">pair</span>: invertedMap[activeOrder.symbol.toUpperCase()],
                            <span class="hljs-attr">price</span>: <span class="hljs-built_in">parseFloat</span>(activeOrder.price),
                            <span class="hljs-attr">side</span>: activeOrder.side
                        })
                    });
                    resolve(activeOrders);
                }
                <span class="hljs-keyword">else</span> {
                    reject(err);
                }
            });
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><code>_getActivePositions</code> returns all active positions active on bitfinex</p>
<pre><code>[
     {
         <span class="hljs-attr">id</span>: <span class="hljs-number">38168717</span>,
         <span class="hljs-attr">pair</span>: <span class="hljs-string">'ETHBTC'</span>,
         <span class="hljs-attr">base</span>: <span class="hljs-number">0.043646</span>,
         <span class="hljs-attr">amount</span>: <span class="hljs-number">.25</span>,
         <span class="hljs-attr">profit</span>: <span class="hljs-number">-0.000030805</span>,
         <span class="hljs-attr">side</span>: <span class="hljs-string">'buy'</span>
     }
]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _getActivePositions = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            bitfinexRest.active_positions(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, activePositionResponse</span>) </span>{
                <span class="hljs-keyword">if</span> (!err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <pre><code> activePositionResponse = [
     {
         <span class="hljs-attr">id</span>: <span class="hljs-number">38168717</span>,
         <span class="hljs-attr">symbol</span>: <span class="hljs-string">'ethbtc'</span>,
         <span class="hljs-attr">status</span>: <span class="hljs-string">'ACTIVE'</span>,
         <span class="hljs-attr">base</span>: <span class="hljs-string">'0.043646'</span>,
         <span class="hljs-attr">amount</span>: <span class="hljs-string">'0.25'</span>,
         <span class="hljs-attr">timestamp</span>: <span class="hljs-string">'1511022525.0'</span>,
         <span class="hljs-attr">swap</span>: <span class="hljs-string">'0.0'</span>,
         <span class="hljs-attr">pl</span>: <span class="hljs-string">'-0.000030805'</span>
     }
 ]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (activePositionResponse.length) {
                        <span class="hljs-keyword">let</span> activePositionArr = [];
                        <span class="hljs-keyword">const</span> invertedMap = _.invert(exchangePairNames);
                        activePositionResponse.forEach(<span class="hljs-function">(<span class="hljs-params">activePos, i</span>) =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <pre><code> {
     <span class="hljs-string">"id"</span>: <span class="hljs-number">38613045</span>,
     <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"btcusd"</span>,
     <span class="hljs-string">"status"</span>: <span class="hljs-string">"ACTIVE"</span>,
     <span class="hljs-string">"base"</span>: <span class="hljs-string">"11150.0"</span>,
     <span class="hljs-string">"amount"</span>: <span class="hljs-string">"0.071"</span>,
     <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"1512211440.0"</span>,
     <span class="hljs-string">"swap"</span>: <span class="hljs-string">"-0.4426557"</span>,
     <span class="hljs-string">"pl"</span>: <span class="hljs-string">"42.986382"</span>
 }
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">let</span> positionId = activePositionResponse[i].id.toString();
                            <span class="hljs-keyword">let</span> positionPairName = invertedMap[activePositionResponse[i].symbol.toUpperCase()];
                            <span class="hljs-keyword">let</span> positionAmount = <span class="hljs-built_in">parseFloat</span>(activePositionResponse[i].amount);
                            <span class="hljs-keyword">let</span> positionPrice = <span class="hljs-built_in">parseFloat</span>(activePositionResponse[i].base);
                            <span class="hljs-keyword">let</span> positionProfit = <span class="hljs-built_in">parseFloat</span>(activePositionResponse[i].pl);
                            activePositionArr.push({
                                <span class="hljs-attr">id</span>: positionId,
                                <span class="hljs-attr">pair</span>: positionPairName,
                                <span class="hljs-attr">base</span>: positionPrice,
                                <span class="hljs-attr">amount</span>: positionAmount,
                                <span class="hljs-attr">profit</span>: positionProfit,
                                <span class="hljs-attr">side</span>: positionAmount &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'buy'</span> : <span class="hljs-string">'sell'</span>
                            });
                            resolve(activePositionArr);
                        });
                    }
                    <span class="hljs-keyword">else</span> {
                        resolve([]); <span class="hljs-comment">// There aren't any active positions</span>
                    }
                }
                <span class="hljs-keyword">else</span> {
                    reject(err);
                }
            });
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><code>_getState</code> gets bot state</p>
<pre><code>state = {
    <span class="hljs-string">"state"</span>: <span class="hljs-string">"active"</span>,
    <span class="hljs-string">"balances"</span>: [{
        <span class="hljs-string">"pair"</span>: <span class="hljs-string">"ETHBTC"</span>,
        <span class="hljs-string">"balance"</span>: <span class="hljs-number">0.13802080706832412</span>,
        <span class="hljs-string">"tradeable"</span>: <span class="hljs-number">0.3130893379539062</span>
    }],
    <span class="hljs-string">"activePairs"</span>: [{
        <span class="hljs-string">"pair"</span>: <span class="hljs-string">"ETHBTC"</span>,
        <span class="hljs-string">"balance"</span>: <span class="hljs-number">0.13802080706832412</span>,
        <span class="hljs-string">"side"</span>: <span class="hljs-string">"buy"</span>,
        <span class="hljs-string">"positions"</span>: [{
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"134514333"</span>,
            <span class="hljs-string">"pair"</span>: <span class="hljs-string">"ETHBTC"</span>,
            <span class="hljs-string">"base"</span>: <span class="hljs-number">0.089331</span>,
            <span class="hljs-string">"amount"</span>: <span class="hljs-number">0.13875501</span>,
            <span class="hljs-string">"profit"</span>: <span class="hljs-number">-0.00001565073259794</span>,
            <span class="hljs-string">"side"</span>: <span class="hljs-string">"buy"</span>
        }],
        <span class="hljs-string">"orders"</span>: []
    }]
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _getState = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            _getBalances().then(<span class="hljs-function"><span class="hljs-params">balances</span> =&gt;</span> {
                <span class="hljs-keyword">let</span> state = {
                    <span class="hljs-attr">state</span>: <span class="hljs-string">'idle'</span>,
                    <span class="hljs-attr">balances</span>: balances,
                    <span class="hljs-attr">activePairs</span>: []
                };
                _getActivePositions().then(<span class="hljs-function"><span class="hljs-params">activePositions</span> =&gt;</span> {
                    _getActiveOrders().then(<span class="hljs-function"><span class="hljs-params">activeOrders</span> =&gt;</span> {
                        activePositions.forEach(<span class="hljs-function"><span class="hljs-params">position</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <pre><code>position = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">38168717</span>,
    <span class="hljs-attr">pair</span>: <span class="hljs-string">'ETHBTC'</span>,
    <span class="hljs-attr">base</span>: <span class="hljs-number">0.043646</span>,
    <span class="hljs-attr">amount</span>: <span class="hljs-number">.25</span>,
    <span class="hljs-attr">profit</span>: <span class="hljs-number">-0.000030805</span>,
    <span class="hljs-attr">side</span>: <span class="hljs-string">'buy'</span>
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (_pairIsEnabled(position.pair)) {
                                <span class="hljs-keyword">let</span> activePair = _.find(state.pairs, {<span class="hljs-attr">pair</span>: position.pair});
                                <span class="hljs-keyword">let</span> activePairIndex = _.findIndex(state.pairs, {<span class="hljs-attr">pair</span>: position.pair});
                                <span class="hljs-keyword">if</span> (!activePair) { <span class="hljs-comment">// Set the state to active</span>
                                    state.state = <span class="hljs-string">'active'</span>;
                                    <span class="hljs-keyword">let</span> balance = _.find(balances, {<span class="hljs-attr">pair</span>: position.pair});
                                    <span class="hljs-keyword">if</span> (balance) balance = balance.balance;
                                    activePair = { <span class="hljs-comment">// Initialise the activePair with default state.</span>
                                        pair: position.pair,
                                        <span class="hljs-attr">balance</span>: balance,
                                        <span class="hljs-attr">side</span>: position.side,
                                        <span class="hljs-attr">positions</span>: [],
                                        <span class="hljs-attr">orders</span>: []
                                    };
                                    state.activePairs.push(activePair);
                                    activePairIndex = state.activePairs.length - <span class="hljs-number">1</span>;
                                }
                                state.activePairs[activePairIndex].positions.push(position);
                            }
                        });
                        activeOrders.forEach(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <pre><code> order = {
     <span class="hljs-string">"id"</span>:<span class="hljs-number">5243424763</span>,
     <span class="hljs-string">"pair"</span>:<span class="hljs-string">"ETHBTC"</span>,
     <span class="hljs-string">"price"</span>: <span class="hljs-number">0.043615</span>,
     <span class="hljs-string">"side"</span>:<span class="hljs-string">"buy"</span>
 }
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (_pairIsEnabled(order.pair)) {
                                <span class="hljs-keyword">let</span> activePair = _.find(state.pairs, {<span class="hljs-attr">pair</span>: order.pair});
                                <span class="hljs-keyword">let</span> activePairIndex = _.findIndex(state.pairs, {<span class="hljs-attr">pair</span>: order.pair});
                                <span class="hljs-keyword">if</span> (!activePair) {
                                    <span class="hljs-keyword">let</span> balance = _.find(balances, {<span class="hljs-attr">pair</span>: order.pair});
                                    <span class="hljs-keyword">if</span> (balance) balance = balance.balance;
                                    activePair = {<span class="hljs-comment">// Initialise the activePair with default state.</span>
                                        pair: order.pair,
                                        <span class="hljs-attr">balance</span>: balance,
                                        <span class="hljs-attr">side</span>: order.side === <span class="hljs-string">'buy'</span> ? <span class="hljs-string">'buy'</span> : <span class="hljs-string">'sell'</span>,
                                        <span class="hljs-attr">positions</span>: [],
                                        <span class="hljs-attr">orders</span>: []
                                    };
                                    state.activePairs.push(activePair);
                                    activePairIndex = state.activePairs.length - <span class="hljs-number">1</span>;
                                }
                                state.activePairs[activePairIndex].orders.push(order);
                            }
                        });
                        resolve(state);
                    }).catch(reject);
                }).catch(reject);
            }).catch(reject);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><code>_stateHasChanged</code> checks to ensure that the state of the bot
has changed. Retries every 3 seconds for up to 15 seconds.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _stateHasChanged = <span class="hljs-function">(<span class="hljs-params">pair, stateTest</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> retry_interval = <span class="hljs-number">1000</span> * <span class="hljs-number">3</span>; <span class="hljs-comment">// 3 seconds</span>
        <span class="hljs-keyword">let</span> hardStop = <span class="hljs-number">5</span> * retry_interval; <span class="hljs-comment">// 15 seconds</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            <span class="hljs-keyword">let</span> __stateHasChanged = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pair, stateTest</span>) </span>{
                _getState().then(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
                    <span class="hljs-keyword">let</span> activePair = _.find(state.activePairs, {<span class="hljs-attr">pair</span>: pair});
                    <span class="hljs-keyword">if</span> (
                        (state.state === <span class="hljs-string">'active'</span> &amp;&amp; activePair.side === stateTest) || <span class="hljs-comment">// 'There are active positions and the side of the positions matches the test state'</span>
                        (!activePair &amp;&amp; stateTest === <span class="hljs-string">'idle'</span>)) { <span class="hljs-comment">// There are no active positions and the test state is 'idle'.</span>
                        logger.log(<span class="hljs-string">'State changed to: '</span> + stateTest);
                        resolve(state); <span class="hljs-comment">// Resolve with the current state</span>
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">if</span> (hardStop &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// If time still less than the hard stop</span>
                            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                                logger.log(<span class="hljs-string">'Retrying state change: '</span> + stateTest);
                                __stateHasChanged(pair, stateTest); <span class="hljs-comment">// recursive call, try again</span>
                                hardStop -= retry_interval;<span class="hljs-comment">// countdown</span>
                            }, retry_interval)
                        }
                        <span class="hljs-keyword">else</span> {
                            reject(<span class="hljs-string">'Failed to change the state.'</span>);
                        }
                    }
                }).catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                    __stateHasChanged(pair, stateTest); <span class="hljs-comment">// recursive call, try again</span>
                })
            };
            __stateHasChanged(pair, stateTest);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><code>_exit</code> Exits all active orders and trades</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _exitAll = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            <span class="hljs-keyword">let</span> cancellations = [];
            _getState().then(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
                <span class="hljs-keyword">let</span> activePairs = [];
                state.activePairs.forEach(<span class="hljs-function"><span class="hljs-params">activePair</span> =&gt;</span> {
                    activePair.positions.forEach(<span class="hljs-function"><span class="hljs-params">position</span> =&gt;</span> {
                        activePairs.push(position.pair);
                    });
                    activePair.orders.forEach(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> {
                        activePairs.push(order.pair);
                    });
                });
                cancellations = _.uniq(activePairs).map(<span class="hljs-function"><span class="hljs-params">pair</span> =&gt;</span> { <span class="hljs-keyword">return</span> _exit(pair) });
                <span class="hljs-keyword">if</span> ( !cancellations.length ){
                    resolve(<span class="hljs-string">'Bot is already idle'</span>);
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-built_in">Promise</span>.all(cancellations).then(resolve).catch(reject);
                }
            }).catch(reject);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>_exit</code> Exits all active orders and trades for a given pair.
Attempts to exit 5 times, each attempt with an updated price.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _exit = <span class="hljs-function">(<span class="hljs-params">pair</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> retryCount = <span class="hljs-number">5</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            <span class="hljs-keyword">let</span> __exit = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                <span class="hljs-keyword">if</span> (retryCount){
                    retryCount--;
                    _getState().then(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
                        <span class="hljs-keyword">let</span> activePair = _.find(state.activePairs, {<span class="hljs-attr">pair</span>: pair});
                        <span class="hljs-keyword">if</span> (activePair) {
                            <span class="hljs-keyword">let</span> orders = activePair.orders.map(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> { <span class="hljs-comment">// Cancel all active orders</span>
                                <span class="hljs-keyword">return</span> _cancelOrder(order.id).catch(__exit);
                            });
                            <span class="hljs-keyword">let</span> positions = activePair.positions.map(<span class="hljs-function"><span class="hljs-params">pos</span> =&gt;</span> {
                                <span class="hljs-keyword">let</span> side = pos.side === <span class="hljs-string">'buy'</span> ? <span class="hljs-string">'sell'</span> : <span class="hljs-string">'buy'</span>;
                                <span class="hljs-keyword">let</span> amount = <span class="hljs-built_in">Math</span>.abs(<span class="hljs-built_in">parseFloat</span>(pos.amount)).toString();
                                <span class="hljs-keyword">return</span> _order(pair, side, amount).catch(__exit); <span class="hljs-comment">// Place a cancellation order for each position, with the opposite side and the same amount.</span>
                            });
                            <span class="hljs-keyword">let</span> cancellations = positions.concat(orders); <span class="hljs-comment">// Cancel both orders and positions</span>
                            <span class="hljs-built_in">Promise</span>.all(cancellations).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-comment">// Once all orders and positions have been exited</span>
                                logger.log(<span class="hljs-string">'Submitted exit orders. Now checking state.'</span>);
                                _stateHasChanged(pair, <span class="hljs-string">'idle'</span>).then(resolve).catch(__exit); <span class="hljs-comment">// Ensure that the state has changed to idle.</span>
                            }).catch(__exit); <span class="hljs-comment">// Retry if it fails.</span>
                        }
                        <span class="hljs-keyword">else</span> {
                            resolve(<span class="hljs-string">'No active positions for: '</span> + pair); <span class="hljs-comment">// Resolve because bot was already idle for this pair</span>
                        }
                    }).catch(__exit);
                }
                <span class="hljs-keyword">else</span> {
                    reject(<span class="hljs-string">'too many failed exit attempts for: '</span> + pair);
                }
            };
            __exit();
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>_cancelOrder</code> Cancels an order with the given order_id;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _cancelOrder = <span class="hljs-function">(<span class="hljs-params">orderId</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            bitfinexRest.cancel_order(orderId.toString(), (err, res) =&gt; {
                <span class="hljs-keyword">if</span> (!err) {
                    logger.log(<span class="hljs-string">'Cancelled order: '</span> + orderId );
                    resolve(res);
                }
                <span class="hljs-keyword">else</span> {
                    reject(err);
                }
            });
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>_parseTradeArguments</code> Preps an object to place an order</p>
<pre><code> {
     <span class="hljs-string">"pair"</span>: <span class="hljs-string">"ETHBTC"</span>,
     <span class="hljs-string">"price"</span>: <span class="hljs-number">0.029201</span>,
     <span class="hljs-string">"amount"</span>: <span class="hljs-string">"0.30"</span>,
     <span class="hljs-string">"exchangePairName"</span>: <span class="hljs-string">"ETHBTC"</span>,
     <span class="hljs-string">"exchange"</span>: <span class="hljs-string">"bitfinex"</span>,
     <span class="hljs-string">"side"</span>: <span class="hljs-string">"buy"</span>,
     <span class="hljs-string">"type"</span>: <span class="hljs-string">"limit"</span>
 }
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _parseTradeArguments = <span class="hljs-function">(<span class="hljs-params">balances, pair, side, amount</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> res = {
            <span class="hljs-attr">data</span>: {},
            <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
        };
        <span class="hljs-keyword">let</span> sides = [<span class="hljs-string">'buy'</span>, <span class="hljs-string">'sell'</span>];
        <span class="hljs-keyword">let</span> price = side === <span class="hljs-string">'buy'</span> ? prices[pair].ask : prices[pair].bid;
        <span class="hljs-keyword">let</span> exchangePairName = exchangePairNames[pair];
        <span class="hljs-keyword">let</span> exchangeBalance = _.find(balances, {<span class="hljs-attr">pair</span>: pair}).balance;
        <span class="hljs-keyword">if</span> (!_.includes(sides, side)) {
            res.error = <span class="hljs-string">'No valid side provided'</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!_.includes(_.keys(exchangePairNames), pair) || !exchangePairName || !exchangePairName.length) {
            res.error = <span class="hljs-string">'No valid pair name provided'</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!_.isNumber(_.find(balances, {<span class="hljs-attr">pair</span>: pair}).balance)) {
            res.error = <span class="hljs-string">'No valid exchangeBalance provided'</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!_.isNumber(price) || !price) {
            res.error = <span class="hljs-string">'No valid price provided'</span>;
        }
        <span class="hljs-keyword">else</span> {
            res.data = {
                pair,
                <span class="hljs-attr">price</span>: price.toString(),
                <span class="hljs-attr">amount</span>: ( amount || exchangeBalance ).toString(),
                exchangePairName,
                <span class="hljs-attr">exchange</span>: <span class="hljs-string">'bitfinex'</span>,
                side,
                <span class="hljs-attr">type</span>: <span class="hljs-string">'limit'</span>
            };
        }
        <span class="hljs-keyword">return</span> res;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><code>_trade</code> Decides the type of order to be placed, and then places it.
Returns the next state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _trade = <span class="hljs-function">(<span class="hljs-params">pair, side</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            _getState().then(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
                <span class="hljs-keyword">let</span> activePair = _.find(state.activePairs, {<span class="hljs-attr">pair</span>: pair});
                <span class="hljs-keyword">let</span> retryCount = <span class="hljs-number">5</span>; <span class="hljs-comment">// Allows five failed attempts at the placing the order, taking a total of 5 x 30 seconds ( 2 and a half minutes total )</span>
                <span class="hljs-keyword">let</span> orderPromise = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                    <span class="hljs-keyword">if</span> (retryCount){
                        retryCount --;
                        <span class="hljs-keyword">return</span> _order(pair, side);
                    }
                    <span class="hljs-keyword">else</span> {
                        reject(<span class="hljs-string">'Too many failed attempts at placing a '</span> + pair + <span class="hljs-string">' trade.'</span>);
                    }
                };
                <span class="hljs-keyword">if</span> (state.state === <span class="hljs-string">'active'</span> &amp;&amp; activePair &amp;&amp; activePair.side !== side) { <span class="hljs-comment">// Swing trade - exit and then place new order</span>
                    _exit(pair).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                        orderPromise().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-comment">// Once the initial position has been exited, place the new order.</span>
                            _stateHasChanged(pair, side).then(resolve).catch(reject); <span class="hljs-comment">// Check that the state has changed to the new side</span>
                        }).catch(orderPromise); <span class="hljs-comment">// When it fails we attempt to place a trade using the same order promise. The asset price updates with each repetition.</span>
                    }).catch(reject); <span class="hljs-comment">// When it fails we attempt to exit again using the same exit promise. The asset price updates with each repetition.</span>
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state.state === <span class="hljs-string">'idle'</span>) { <span class="hljs-comment">// The state was previously idle</span>
                    orderPromise().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-comment">// Vanilla trade</span>
                        _stateHasChanged(pair, side).then(resolve).catch(reject); <span class="hljs-comment">// Check that the state has changed to the new side</span>
                    }).catch(orderPromise); <span class="hljs-comment">// When it fails we attempt to place a trade using the same order promise. The asset price updates with each repetition.</span>
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state.state === <span class="hljs-string">'active'</span> &amp;&amp; activePair &amp;&amp; activePair.side === side) {<span class="hljs-comment">// There is already an active position on the specified side for this pair.</span>
                    reject(<span class="hljs-string">'There is already a '</span> + side + <span class="hljs-string">' in place for '</span> + pair); <span class="hljs-comment">// The sides are the same. No adding to a position for now.</span>
                }
            })
        })
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>_order</code> Places an order to bitfinex.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> _order = <span class="hljs-function">(<span class="hljs-params">pair, side, amount</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            _getBalances().then(<span class="hljs-function"><span class="hljs-params">balances</span> =&gt;</span> {
                <span class="hljs-keyword">let</span> tradeData = _parseTradeArguments(balances, pair, side, amount);
                <span class="hljs-keyword">if</span> (!tradeData.error) {
                    tradeData = tradeData.data;
                    bitfinexRest.new_order(tradeData.exchangePairName, tradeData.amount, tradeData.price, tradeData.exchange, tradeData.side, tradeData.type, (err, data) =&gt; {<span class="hljs-comment">// symbol, amount, price, exchange, side, type, is_hidden, postOnly, cb</span>
                        <span class="hljs-keyword">if</span> (!err) {
                            resolve();
                        }
                        <span class="hljs-keyword">else</span> {
                            reject(err);
                        }
                    });
                }
                <span class="hljs-keyword">else</span> {
                    reject(tradeData.error);
                }
            }).catch(reject);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Exposed public functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">init</span>: _init,
        <span class="hljs-attr">exit</span>: _exit,
        <span class="hljs-attr">exitAll</span>: _exitAll,
        <span class="hljs-attr">trade</span>: _trade,
        <span class="hljs-attr">order</span>: _order,
        <span class="hljs-attr">getState</span>: _getState,
        <span class="hljs-attr">getBalances</span>: _getBalances,
        <span class="hljs-attr">getActiveOrders</span>: _getActiveOrders,
        <span class="hljs-attr">getActivePositions</span>: _getActivePositions,
    };
})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
